<div class="flex flex-col h-full p-4 bg-white/70 backdrop-blur-sm">

  <!-- Tin nhắn -->
  <div class="flex-1 overflow-y-auto p-2 mb-2 space-y-2 border border-gray-200 rounded-lg bg-white/50">
    <div *ngFor="let msg of messages" 
         class="flex mb-2"
         [ngClass]="msg.senderId === currentUserId ? 'justify-end' : 'justify-start'">

      <div class="flex flex-col max-w-xs">
        <!-- Tên người gửi (chỉ hiện tên người khác) -->
        <div class="text-xs text-gray-500 mb-1" *ngIf="msg.senderId !== currentUserId">
          {{ msg.sender }}
        </div>

        <!-- Tin nhắn text -->
        <div *ngIf="msg.type === 'CHAT'" 
             class="px-3 py-2 rounded-lg break-words"
             [ngClass]="msg.senderId === currentUserId ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'">
          {{ msg.content }}
        </div>

        <!-- Tin nhắn ảnh -->
        <div *ngIf="msg.type === 'IMAGE'" class="mt-1">
          <img [src]="msg.content" class="max-w-[200px] rounded-lg border" />
        </div>

        <!-- Tin nhắn file -->
        <div *ngIf="msg.type === 'FILE'" class="mt-1">
          <a [href]="msg.content" target="_blank" class="text-blue-600 underline">
            {{ msg.filename || msg.content }}
          </a>
        </div>

        <!-- Join/Leave/System -->
        <div *ngIf="msg.type !== 'CHAT' && msg.type !== 'IMAGE' && msg.type !== 'FILE'" 
             class="text-sm text-gray-500 italic px-2">
          <span *ngIf="msg.type==='JOIN'">✅ {{ msg.content }}</span>
          <span *ngIf="msg.type==='LEAVE'">👋 {{ msg.content }}</span>
          <span *ngIf="msg.type==='SYSTEM'">⚙️ {{ msg.content }}</span>
        </div>

      </div>
    </div>
  </div>

  <!-- Input + Upload -->
  <div class="flex gap-2 mt-2">
    <input [(ngModel)]="messageContent" placeholder="Nhập tin nhắn..."
           class="flex-1 px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400" />

    <input type="file" #fileInput hidden (change)="onFileSelected($event)" />
    <button (click)="fileInput.click()" class="bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-colors">
      📎
    </button>

    <button (click)="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
      Gửi
    </button>
  </div>

  <!-- Users -->
  <h3 class="text-lg font-bold mt-4 mb-2 border-b pb-1">🧑‍🤝‍🧑 Thành viên phòng</h3>
  <ul class="space-y-1 max-h-48 overflow-y-auto">
    <li *ngFor="let u of usersInRoom" class="flex justify-between items-center px-2 py-1 rounded-lg bg-gray-100/50">
      <span>{{ u.username }}</span>
      <button *ngIf="isAdmin && u.id !== currentUserId"
              (click)="kickUser(u.id)"
              class="bg-red-500 text-white px-2 py-1 rounded-lg hover:bg-red-600 transition-colors text-sm">
        ❌ Kick
      </button>
    </li>
  </ul>
</div>
