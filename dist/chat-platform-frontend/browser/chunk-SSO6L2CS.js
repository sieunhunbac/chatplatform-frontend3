import{a as G,b as J}from"./chunk-PXITHTHD.js";import{a as W,b as z,e as K,h as Y,i as q}from"./chunk-QMHT4RDO.js";import{$ as p,B as o,D as m,E as I,I as v,M as a,N as s,O as r,P as C,T as U,U as g,W as l,X as P,Z as c,_ as j,aa as R,ba as H,ca as V,f as A,j as F,ja as N,ka as $,la as L,ma as w,n as _,oa as b,q as y,r as T,t as h,ta as S,u as x,va as B,z as D}from"./chunk-LEPOSHV4.js";var k=class n{constructor(t){this.http=t}baseUrl="https://chatplatform3-11-yl72.onrender.com/api/chatrooms";roomsUrl="https://chatplatform3-11-yl72.onrender.com/api/rooms";getUsersInRoom(t){return this.http.get(`${this.baseUrl}/${t}/users`)}getAllRooms(){return this.http.get(this.roomsUrl)}kickUser(t,e){return this.http.delete(`${this.roomsUrl}/${t}/kick/${e}`)}static \u0275fac=function(e){return new(e||n)(y(b))};static \u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})};var E=class n{constructor(t){this.http=t}uploadFile(t){let e=new FormData;return e.append("file",t),this.http.post("http://localhost:8080/api/files/upload",e,{responseType:"text"}).pipe(F(i=>({url:i,filename:t.name,type:t.type})))}static \u0275fac=function(e){return new(e||n)(y(b))};static \u0275prov=_({token:n,factory:n.\u0275fac,providedIn:"root"})};function ie(n,t){if(n&1&&(s(0,"div",18),c(1),r()),n&2){let e=l().$implicit;o(),p(" ",e.sender," ")}}function oe(n,t){if(n&1&&(s(0,"div",19),c(1),r()),n&2){let e=l().$implicit,i=l();a("ngClass",e.senderId===i.currentUserId?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"),o(),p(" ",e.content," ")}}function re(n,t){if(n&1&&(s(0,"div",20),C(1,"img",21),r()),n&2){let e=l().$implicit;o(),a("src",e.content,D)}}function se(n,t){if(n&1&&(s(0,"div",20)(1,"a",22),c(2),r()()),n&2){let e=l().$implicit;o(),a("href",e.content,D),o(),p(" ",e.filename||e.content," ")}}function ae(n,t){if(n&1&&(s(0,"span"),c(1),r()),n&2){let e=l(2).$implicit;o(),p("\u2705 ",e.content)}}function ce(n,t){if(n&1&&(s(0,"span"),c(1),r()),n&2){let e=l(2).$implicit;o(),p("\u{1F44B} ",e.content)}}function le(n,t){if(n&1&&(s(0,"span"),c(1),r()),n&2){let e=l(2).$implicit;o(),p("\u2699\uFE0F ",e.content)}}function de(n,t){if(n&1&&(s(0,"div",23),v(1,ae,2,1,"span",24)(2,ce,2,1,"span",24)(3,le,2,1,"span",24),r()),n&2){let e=l().$implicit;o(),a("ngIf",e.type==="JOIN"),o(),a("ngIf",e.type==="LEAVE"),o(),a("ngIf",e.type==="SYSTEM")}}function me(n,t){if(n&1&&(s(0,"div",12)(1,"div",13),v(2,ie,2,1,"div",14)(3,oe,2,2,"div",15)(4,re,2,1,"div",16)(5,se,3,2,"div",16)(6,de,4,3,"div",17),r()()),n&2){let e=t.$implicit,i=l();a("ngClass",e.senderId===i.currentUserId?"justify-end":"justify-start"),o(2),a("ngIf",e.senderId!==i.currentUserId),o(),a("ngIf",e.type==="CHAT"),o(),a("ngIf",e.type==="IMAGE"),o(),a("ngIf",e.type==="FILE"),o(),a("ngIf",e.type!=="CHAT"&&e.type!=="IMAGE"&&e.type!=="FILE")}}function pe(n,t){if(n&1){let e=U();s(0,"button",27),g("click",function(){h(e);let d=l().$implicit,f=l();return x(f.kickUser(d.id))}),c(1," \u274C Kick "),r()}}function ue(n,t){if(n&1&&(s(0,"li",25)(1,"span"),c(2),r(),v(3,pe,2,0,"button",26),r()),n&2){let e=t.$implicit,i=l();o(2),j(e.username),o(),a("ngIf",i.isAdmin&&e.id!==i.currentUserId)}}var M=class n{constructor(t,e,i,d,f){this.socketService=t;this.route=e;this.roomService=i;this.authService=d;this.fileService=f}http=T(b);boundBeforeUnloadHandler;roomId;usersInRoom=[];messages=[];messageContent="";sender="User1";currentUserId=1;isAdmin=!1;ngOnInit(){let t=this.authService.getCurrentUser();this.sender=t.username,this.currentUserId=t.id,this.isAdmin=t.isAdmin,this.roomId=this.route.snapshot.paramMap.get("roomId")||"",this.loadUsers(),this.socketService.connect(this.roomId),setTimeout(()=>{this.socketService.addUser({sender:this.sender,content:"",roomId:this.roomId,type:"JOIN",userId:this.currentUserId})},1e3),this.socketService.getMessages().subscribe(e=>{if(e.roomId===this.roomId)switch(e.type){case"CHAT":case"IMAGE":case"FILE":this.messages.push(e);break;case"JOIN":case"LEAVE":this.messages.push({sender:"H\u1EC7 th\u1ED1ng",content:e.content,roomId:this.roomId,type:"SYSTEM"}),this.loadUsers();break}}),this.boundBeforeUnloadHandler=this.beforeUnloadHandler.bind(this),window.addEventListener("beforeunload",this.boundBeforeUnloadHandler)}sendMessage(){if(this.messageContent.trim()!==""){let t={content:this.messageContent,senderId:this.currentUserId,sender:this.sender,roomId:this.roomId,type:"CHAT"};this.socketService.sendMessage(t),this.messageContent=""}}loadUsers(){this.roomId&&this.roomService.getUsersInRoom(this.roomId).subscribe({next:t=>this.usersInRoom=t,error:t=>console.error("L\u1ED7i loadUsers:",t)})}kickUser(t){confirm("B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n kick user n\xE0y?")&&this.roomService.kickUser(this.roomId,t).subscribe({next:()=>{console.log("\u2705 Kick th\xE0nh c\xF4ng"),this.loadUsers()},error:e=>console.error("\u274C Kick th\u1EA5t b\u1EA1i:",e)})}beforeUnloadHandler(t){let e={sender:this.sender,content:"",roomId:this.roomId,type:"LEAVE"};if(navigator.sendBeacon){let i="http://localhost:8080/api/leave",d=JSON.stringify(e);navigator.sendBeacon(i,new Blob([d],{type:"application/json"}))}else this.socketService.sendMessage(e)}ngOnDestroy(){let t={sender:this.sender,content:"",roomId:this.roomId,type:"LEAVE"};this.socketService.sendMessage(t),window.removeEventListener("beforeunload",this.boundBeforeUnloadHandler)}onFileSelected(t){return A(this,null,function*(){let e=t.target.files[0];e&&this.fileService.uploadFile(e).subscribe({next:i=>{let d={senderId:this.currentUserId,sender:this.sender,content:i.url,roomId:this.roomId,type:i.type.startsWith("image/")?"IMAGE":"FILE",filename:i.filename};this.socketService.sendMessage(d)},error:i=>console.error("Upload failed:",i)})})}static \u0275fac=function(e){return new(e||n)(m(G),m(S),m(k),m(q),m(E))};static \u0275cmp=I({type:n,selectors:[["app-chat"]],inputs:{roomId:"roomId"},decls:15,vars:3,consts:[["fileInput",""],[1,"flex","flex-col","h-full","p-4","bg-white/70","backdrop-blur-sm"],[1,"flex-1","overflow-y-auto","p-2","mb-2","space-y-2","border","border-gray-200","rounded-lg","bg-white/50"],["class","flex mb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","gap-2","mt-2"],["placeholder","Nh\u1EADp tin nh\u1EAFn...",1,"flex-1","px-3","py-2","rounded-lg","border","border-gray-300","focus:outline-none","focus:ring-2","focus:ring-blue-400",3,"ngModelChange","ngModel"],["type","file","hidden","",3,"change"],[1,"bg-green-500","text-white","px-3","py-2","rounded-lg","hover:bg-green-600","transition-colors",3,"click"],[1,"bg-blue-500","text-white","px-4","py-2","rounded-lg","hover:bg-blue-600","transition-colors",3,"click"],[1,"text-lg","font-bold","mt-4","mb-2","border-b","pb-1"],[1,"space-y-1","max-h-48","overflow-y-auto"],["class","flex justify-between items-center px-2 py-1 rounded-lg bg-gray-100/50",4,"ngFor","ngForOf"],[1,"flex","mb-2",3,"ngClass"],[1,"flex","flex-col","max-w-xs"],["class","text-xs text-gray-500 mb-1",4,"ngIf"],["class","px-3 py-2 rounded-lg break-words",3,"ngClass",4,"ngIf"],["class","mt-1",4,"ngIf"],["class","text-sm text-gray-500 italic px-2",4,"ngIf"],[1,"text-xs","text-gray-500","mb-1"],[1,"px-3","py-2","rounded-lg","break-words",3,"ngClass"],[1,"mt-1"],[1,"max-w-[200px]","rounded-lg","border",3,"src"],["target","_blank",1,"text-blue-600","underline",3,"href"],[1,"text-sm","text-gray-500","italic","px-2"],[4,"ngIf"],[1,"flex","justify-between","items-center","px-2","py-1","rounded-lg","bg-gray-100/50"],["class","bg-red-500 text-white px-2 py-1 rounded-lg hover:bg-red-600 transition-colors text-sm",3,"click",4,"ngIf"],[1,"bg-red-500","text-white","px-2","py-1","rounded-lg","hover:bg-red-600","transition-colors","text-sm",3,"click"]],template:function(e,i){if(e&1){let d=U();s(0,"div",1)(1,"div",2),v(2,me,7,6,"div",3),r(),s(3,"div",4)(4,"input",5),V("ngModelChange",function(u){return h(d),H(i.messageContent,u)||(i.messageContent=u),x(u)}),r(),s(5,"input",6,0),g("change",function(u){return h(d),x(i.onFileSelected(u))}),r(),s(7,"button",7),g("click",function(){h(d);let u=P(6);return x(u.click())}),c(8," \u{1F4CE} "),r(),s(9,"button",8),g("click",function(){return h(d),x(i.sendMessage())}),c(10," G\u1EEDi "),r()(),s(11,"h3",9),c(12,"\u{1F9D1}\u200D\u{1F91D}\u200D\u{1F9D1} Th\xE0nh vi\xEAn ph\xF2ng"),r(),s(13,"ul",10),v(14,ue,4,2,"li",11),r()()}e&2&&(o(2),a("ngForOf",i.messages),o(2),R("ngModel",i.messageContent),o(10),a("ngForOf",i.usersInRoom))},dependencies:[Y,W,z,K,w,N,$,L],styles:[".justify-end[_ngcontent-%COMP%]{justify-content:flex-end}.justify-start[_ngcontent-%COMP%]{justify-content:flex-start}.bg-blue-500[_ngcontent-%COMP%]{background-color:#3b82f6}.text-white[_ngcontent-%COMP%]{color:#fff}.bg-gray-200[_ngcontent-%COMP%]{background-color:#e5e7eb}.text-gray-800[_ngcontent-%COMP%]{color:#1f2937}"]})};var Q=class n{constructor(t,e){this.route=t;this.router=e;this.roomId=this.route.snapshot.paramMap.get("roomId")??"",this.username=localStorage.getItem("username")??"Guest"}roomId="";username="";leaveRoom(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||n)(m(S),m(B))};static \u0275cmp=I({type:n,selectors:[["app-chat-room-page"]],decls:11,vars:3,consts:[[1,"min-h-screen","flex","flex-col","bg-gradient-to-r","from-pink-200","via-purple-200","to-blue-200"],[1,"flex-1","flex","flex-col","md:flex-row","gap-6","p-6","max-w-6xl","mx-auto","mt-6","w-full"],[1,"flex-1","bg-white","rounded-2xl","shadow-2xl","overflow-hidden","flex","flex-col"],[1,"flex-1",3,"roomId"],[1,"w-full","md:w-80","bg-white","rounded-2xl","shadow-2xl","flex","flex-col","overflow-hidden"],[1,"bg-white/90","backdrop-blur-sm","border-t","p-4","flex","justify-between","items-center","max-w-6xl","mx-auto","rounded-t-2xl","shadow-inner"],[1,"text-gray-700","font-medium"],[1,"bg-red-500","text-white","px-4","py-2","rounded-lg","hover:bg-red-600","transition-colors",3,"click"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),C(3,"app-video-call",3),r(),s(4,"div",4),C(5,"app-chat",3),r()(),s(6,"div",5)(7,"p",6),c(8),r(),s(9,"button",7),g("click",function(){return i.leaveRoom()}),c(10," \u{1F6AA} R\u1EDDi ph\xF2ng "),r()()()),e&2&&(o(3),a("roomId",i.roomId),o(2),a("roomId",i.roomId),o(3),p("\u{1F464} \u0110ang \u0111\u0103ng nh\u1EADp: ",i.username))},dependencies:[w,J,M],styles:[".container[_ngcontent-%COMP%]{display:flex;height:100vh;background-color:#f5f5f5;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.video-section[_ngcontent-%COMP%]{flex:2;border-right:2px solid #ddd;padding:16px;display:flex;flex-direction:column;align-items:center}.video-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px}.video-player[_ngcontent-%COMP%]{width:100%;height:45vh;background-color:#000;border-radius:8px;margin-bottom:10px;box-shadow:0 0 6px #0000004d}.chat-section[_ngcontent-%COMP%]{flex:1;padding:16px;display:flex;flex-direction:column;justify-content:space-between}.chat-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px}.messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;border:1px solid #ccc;border-radius:6px;background-color:#fff;padding:8px;margin-bottom:12px;box-shadow:inset 0 0 4px #0000000d}.messages[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:8px;line-height:1.4}input[placeholder][_ngcontent-%COMP%]{padding:8px;font-size:14px;border:1px solid #aaa;border-radius:4px;margin-bottom:6px;outline:none}button[_ngcontent-%COMP%]{padding:8px;background-color:#007bff;border:none;color:#fff;font-weight:700;border-radius:4px;cursor:pointer;transition:background-color .2s ease}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};export{Q as ChatRoomPage};
